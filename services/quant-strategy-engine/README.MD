ğŸ“ é¡¹ç›®ç»“æ„æ€»è§ˆ

âš™ï¸ æ ¸å¿ƒè°ƒç”¨æµç¨‹ï¼ˆæŒ‰æ‰§è¡Œé¡ºåºï¼‰

ğŸ§© ä½¿ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼è¯´æ˜

ğŸ§  æ‰©å±•æ€§ä¸é›†æˆç‚¹ï¼ˆä¾‹å¦‚è´£ä»»é“¾è¿˜èƒ½æŒ‚ä»€ä¹ˆï¼‰

ğŸ§° è°ƒç”¨ç¤ºä¾‹ä¸å…¸å‹æ‰§è¡Œè·¯å¾„å›¾è§£

ğŸš€ æ€§èƒ½ä¼˜åŒ–ä¸é«˜å¹¶å‘ç­–ç•¥


# ğŸ“ˆ Quant Strategy Engine

**é‡åŒ–ç­–ç•¥å¼•æ“æ¨¡å—ï¼ˆquant-strategy-engineï¼‰**

è¯¥æ¨¡å—æ˜¯æ•´ä¸ªé‡åŒ–é€‰è‚¡ç³»ç»Ÿçš„**æ ¸å¿ƒç­–ç•¥è®¡ç®—å¼•æ“**ï¼Œè´Ÿè´£æ ¹æ®ç”¨æˆ·è¯·æ±‚åŠ¨æ€ç»„åˆå¹¶æ‰§è¡Œå¤šç§é‡åŒ–ç­–ç•¥ï¼Œæ”¯æŒå¼‚æ­¥å¹¶å‘æ‰§è¡Œã€ç»“æœèšåˆã€ç¼“å­˜ä¼˜åŒ–ã€åˆ†å¸ƒå¼é”åˆå¹¶ã€Kafkaå¼‚æ­¥æ¨é€ä¸é™æµç†”æ–­ç­‰é«˜å¹¶å‘ç‰¹æ€§ã€‚

---

## ğŸ§± ä¸€ã€é¡¹ç›®ç»“æ„æ¦‚è§ˆ
```text
com.hao.strategyengine
â”œâ”€ api
â”‚ â””â”€ controller # æ§åˆ¶å±‚ï¼ˆæ¥æ”¶å¤–éƒ¨è¯·æ±‚ï¼‰
â”‚ â”œâ”€ StrategyController.java
â”‚ â””â”€ HealthController.java
â”‚
â”œâ”€ chain # è´£ä»»é“¾æ¨¡å¼ï¼ˆé£æ§ã€é™æµã€é‰´æƒç­‰ï¼‰
â”‚ â”œâ”€ AuthHandler.java
â”‚ â”œâ”€ RateLimitHandler.java
â”‚ â”œâ”€ RiskCheckHandler.java
â”‚ â””â”€ StrategyChain.java
â”‚
â”œâ”€ common # å…¬å…±å·¥å…·ä¸æ¨¡å‹ï¼ˆè·¨æ¨¡å—å¤ç”¨ï¼‰
â”‚ â”œâ”€ cache # ä¸€çº§ç¼“å­˜ã€Redisç¼“å­˜
â”‚ â”‚ â”œâ”€ L1CacheService.java
â”‚ â”‚ â””â”€ StrategyCacheService.java
â”‚ â”œâ”€ config # å…¬å…±é…ç½®ï¼ˆçº¿ç¨‹æ± ç­‰ï¼‰
â”‚ â”‚ â””â”€ ThreadPoolConfig.java
â”‚ â”œâ”€ model # å…¬å…±æ¨¡å‹
â”‚ â”‚ â”œâ”€ core/StrategyContext.java
â”‚ â”‚ â”œâ”€ market/MarketData.java
â”‚ â”‚ â”œâ”€ request/StrategyRequest.java
â”‚ â”‚ â”œâ”€ response/StrategyResult*.java
â”‚ â”‚ â””â”€ vo/StockBasicInfoQueryResultVO.java
â”‚ â””â”€ util/KeyUtils.java
â”‚
â”œâ”€ core # æ ¸å¿ƒå¼•æ“è°ƒåº¦é€»è¾‘
â”‚ â”œâ”€ dispatcher/StrategyDispatcher.java # ç­–ç•¥åˆ†å‘æ‰§è¡Œ
â”‚ â”œâ”€ facade/StrategyEngineFacade.java # å¤–è§‚å±‚ï¼ˆå°è£…æ•´ä¸ªæ‰§è¡Œæµç¨‹ï¼‰
â”‚ â”œâ”€ registry/StrategyRegistry.java # ç­–ç•¥æ³¨å†Œä¸­å¿ƒ
â”‚ â”œâ”€ handler/ExceptionHandler.java # å¼‚å¸¸æ•è·
â”‚ â””â”€ StrategyHandler.java # é€šç”¨æ¥å£
â”‚
â”œâ”€ integration # å¤–éƒ¨ç³»ç»Ÿé›†æˆ
â”‚ â”œâ”€ db/mapper/StrategyResultMapper.java
â”‚ â”œâ”€ feign/DataCollectorClient.java
â”‚ â”œâ”€ kafka/
â”‚ â”‚ â”œâ”€ KafkaConsumerConfig.java
â”‚ â”‚ â”œâ”€ KafkaConsumerService.java
â”‚ â”‚ â””â”€ KafkaResultPublisher.java
â”‚ â”œâ”€ nacos/properties/StrategyProperties.java
â”‚ â””â”€ redis/
â”‚ â”œâ”€ RedisClient.java
â”‚ â””â”€ RedisConfig.java
â”‚
â”œâ”€ resilience # å®¹é”™ä¸é™æµ
â”‚ â”œâ”€ CircuitBreakerService.java
â”‚ â”œâ”€ FallbackHandler.java
â”‚ â””â”€ RateLimiterService.java
â”‚
â”œâ”€ service # å¯¹å¤–æœåŠ¡æ¥å£ä¸å®ç°
â”‚ â”œâ”€ StrategyService.java
â”‚ â”œâ”€ interf/
â”‚ â”‚ â”œâ”€ DragonTwoService.java
â”‚ â”‚ â””â”€ StockStrategy.java
â”‚ â””â”€ impl/
â”‚ â””â”€ DragonTwoServiceImpl.java
â”‚
â”œâ”€ strategy # ç­–ç•¥ç®—æ³•å±‚
â”‚ â”œâ”€ QuantStrategy.java # ç­–ç•¥æŠ½è±¡æ¥å£
â”‚ â”œâ”€ decorator/CachingDecorator.java # è£…é¥°è€…æ¨¡å¼
â”‚ â”œâ”€ impl/
â”‚ â”‚ â”œâ”€ CompositeStrategy.java # å¤åˆç­–ç•¥
â”‚ â”‚ â”œâ”€ MovingAverageStrategy.java # ç§»åŠ¨å‡çº¿
â”‚ â”‚ â””â”€ MomentumStrategy.java # åŠ¨é‡ç­–ç•¥
â”‚ â””â”€ lock/DistributedLockService.java # Redisåˆ†å¸ƒå¼é” + è¯·æ±‚åˆå¹¶
â”‚
â””â”€ monitoring # ğŸ†• æ–°å¢ï¼šç›‘æ§æ¨¡å—
â”œâ”€ MetricsCollector.java
â”œâ”€ AlertService.java
â””â”€ TraceInterceptor.java
```
---
## âš™ï¸ äºŒã€è°ƒç”¨æµç¨‹ï¼ˆæ‰§è¡Œé¡ºåºï¼‰

### ç”¨æˆ·è¯·æ±‚æµç¨‹ï¼ˆä» Controller åˆ° Kafkaï¼‰

1. **Controller å±‚**  
   â†’ `StrategyController.execute(request)`
    - æ¥æ”¶ç”¨æˆ·è¯·æ±‚ï¼ˆåŒ…å« userIdã€symbolã€strategyIdsï¼‰
    - æ„å»º `StrategyContext` å¯¹è±¡
    - è°ƒç”¨ `StrategyEngineFacade.executeAll(...)`

2. **Facade å±‚ï¼ˆå¤–è§‚æ¨¡å¼ï¼‰**  
   â†’ `StrategyEngineFacade.executeAll()`
    - è§¦å‘å‰ç½®è´£ä»»é“¾æ ¡éªŒï¼ˆ`StrategyChain.apply()`ï¼‰
    - æ‹¼æ¥ç»„åˆ keyï¼ˆ`KeyUtils.comboKey()`ï¼‰
    - é€šè¿‡ **DistributedLockService** æ£€æŸ¥æ˜¯å¦å·²æœ‰è¯·æ±‚åœ¨æ‰§è¡Œï¼š
        - å¦‚æœæ— äººæ‰§è¡Œï¼šè·å– Redis åˆ†å¸ƒå¼é”ï¼Œå¼‚æ­¥å¹¶å‘æ‰§è¡Œç­–ç•¥è®¡ç®—
        - å¦‚æœå·²æœ‰è¯·æ±‚ï¼šç­‰å¾… `CompletableFuture` å®Œæˆç»“æœï¼ˆRequest Coalescingï¼‰

3. **Dispatcher å±‚**  
   â†’ `StrategyDispatcher.dispatch(strategyId, context)`
    - æŸ¥æ‰¾ç­–ç•¥å®ç°ï¼ˆ`StrategyRegistry.get(id)`)
    - ç”¨ `CachingDecorator` åŒ…è£…ç­–ç•¥ï¼ˆæ·»åŠ ç¼“å­˜é€»è¾‘ï¼‰
    - æ‰§è¡Œ `QuantStrategy.execute()` å…·ä½“ç®—æ³•

4. **ç­–ç•¥å±‚ï¼ˆStrategyï¼‰**
    - å…·ä½“å®ç°ç±»å¦‚ï¼š
        - `MovingAverageStrategy`
        - `MomentumStrategy`
        - `CompositeStrategy`ï¼ˆå¤åˆæ‰§è¡Œå¤šä¸ªç­–ç•¥ï¼‰
    - æ¯ä¸ªç­–ç•¥æ‰§è¡Œåè¿”å› `StrategyResult`

5. **ç»“æœèšåˆä¸å¼‚æ­¥æ¨é€**
    - èšåˆç»“æœä¸º `StrategyResultBundle`
    - å¼‚æ­¥å‘é€åˆ° Kafkaï¼ˆ`KafkaResultPublisher.publish()`ï¼‰
    - Kafka å¼‚æ­¥æ¶ˆè´¹å¤„ç†è½åº“ã€ç›‘æ§ã€å‘Šè­¦ç­‰

6. **ç›‘æ§é“¾è·¯**
    - `TraceInterceptor` æ‹¦æˆªå…¨é“¾è·¯
    - `MetricsCollector` ç»Ÿè®¡æ‰§è¡Œè€—æ—¶ã€å‘½ä¸­ç‡ã€é”ç­‰å¾…æ—¶é—´
    - `AlertService` æ¨é€è¶…æ—¶ä¸é”™è¯¯å‘Šè­¦

---


## ğŸ§© ä¸‰ã€ä½¿ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼

| æ¨¡å¼ | ä½ç½® | ä½œç”¨ |
|------|------|------|
| **ç­–ç•¥æ¨¡å¼ (Strategy)** | `QuantStrategy` + å„ç§ `impl` | å°†æ¯ç§ç®—æ³•ç‹¬ç«‹å°è£…ï¼Œä¾¿äºæ‰©å±• |
| **è£…é¥°è€…æ¨¡å¼ (Decorator)** | `CachingDecorator` | åŠ¨æ€å¢å¼ºç­–ç•¥æ‰§è¡Œé€»è¾‘ï¼ˆç¼“å­˜ã€é™æµã€æ—¥å¿—ï¼‰ |
| **è´£ä»»é“¾æ¨¡å¼ (Chain of Responsibility)** | `StrategyChain` + å¤šä¸ª Handler | åœ¨æ‰§è¡Œå‰è¿›è¡Œé£æ§ã€é‰´æƒã€é™æµç­‰å¯æ’æ‹”é€»è¾‘ |
| **å¤åˆæ¨¡å¼ (Composite)** | `CompositeStrategy` | æ”¯æŒå¼ºç›¸å…³ç­–ç•¥ç»„åˆæ‰§è¡Œ |
| **å¤–è§‚æ¨¡å¼ (Facade)** | `StrategyEngineFacade` | å°è£…å¤æ‚æ‰§è¡Œé€»è¾‘ï¼Œå¯¹å¤–æš´éœ²ç»Ÿä¸€æ¥å£ |
| **è§‚å¯Ÿè€…æ¨¡å¼ (Observer / PubSub)** | Kafka é›†æˆæ¨¡å— | ç»“æœå¼‚æ­¥åˆ†å‘ç»™ä¸åŒæ¶ˆè´¹è€… |
| **æ¨¡æ¿æ–¹æ³•æ¨¡å¼ (Template)** | å„ç­–ç•¥æ‰§è¡Œæ¨¡æ¿å¯å¤ç”¨ | ç»Ÿä¸€æ‰§è¡Œæµç¨‹ï¼Œå­ç±»åªå®ç°å·®å¼‚åŒ–é€»è¾‘ |
| **å•ä¾‹æ¨¡å¼ (Singleton)** | Spring Beanç®¡ç†çš„å„ä¸ªæœåŠ¡ | ä¿è¯çº¿ç¨‹å®‰å…¨ä¸å…¨å±€å”¯ä¸€æ€§ |
| **åˆ†å¸ƒå¼é”æ¨¡å¼ (Locking + Coalescing)** | `DistributedLockService` | åˆå¹¶ç›¸åŒç­–ç•¥ç»„åˆè¯·æ±‚ï¼Œé˜²æ­¢é‡å¤è®¡ç®— |

---

## ğŸ”— å››ã€è´£ä»»é“¾çš„æ‰©å±•ç‚¹ï¼ˆå¯çƒ­æ’æ‹”ï¼‰

å½“å‰è´£ä»»é“¾åŒ…æ‹¬ï¼š

- `AuthHandler` â€” é‰´æƒæ ¡éªŒ
- `RateLimitHandler` â€” é™æµä¿æŠ¤
- `RiskCheckHandler` â€” é£æ§æ‹¦æˆª

æœªæ¥å¯**æ— ä¾µå…¥æ‰©å±•**ä»¥ä¸‹æ¨¡å—ï¼š

| å¯æ–°å¢Handler | åŠŸèƒ½ |
|----------------|------|
| `GrayReleaseHandler` | æŒ‰ç”¨æˆ·åˆ†æµç­–ç•¥ç°åº¦æµ‹è¯• |
| `TracingHandler` | æ‰“ç‚¹é“¾è·¯æ—¥å¿— / OpenTelemetryé›†æˆ |
| `FeatureToggleHandler` | æ ¹æ®é…ç½®åŠ¨æ€å¯åœç­–ç•¥ |
| `PreCacheHandler` | æå‰åŠ è½½ä¾èµ–æ•°æ®ä»¥å‡å°‘é¦–æ¬¡å†·å¯åŠ¨è€—æ—¶ |
| `AuditHandler` | è®°å½•ç”¨æˆ·ç­–ç•¥è°ƒç”¨å®¡è®¡æ—¥å¿— |

æ¯ä¸ªHandleré€šè¿‡Springè‡ªåŠ¨æ³¨å…¥åˆ°`StrategyChain`ï¼Œ  
æŒ‰`@Order`é¡ºåºæ‰§è¡Œï¼Œè§£è€¦è€Œä¸”å¯è¿è¡Œæ—¶æ‰©å±•ã€‚

---



## ğŸ”„ äº”ã€è°ƒç”¨æ—¶åºå›¾ï¼ˆé€»è¾‘è·¯å¾„ï¼‰

```text
ç”¨æˆ·è¯·æ±‚
   â”‚
   â–¼
StrategyController.execute()
   â”‚
   â–¼
StrategyEngineFacade.executeAll()
   â”œâ”€â–¶ StrategyChain.apply()
   â”œâ”€â–¶ DistributedLockService.acquireOrWait()
   â”‚      â”œâ”€â–¶ Redis Lock å°è¯•åŠ é”
   â”‚      â”œâ”€â–¶ è‹¥é”ç©ºé—² â†’ compute()
   â”‚      â””â”€â–¶ è‹¥é”è¢«å  â†’ ç­‰å¾… pending future
   â”œâ”€â–¶ å¹¶å‘æ‰§è¡Œæ¯ä¸ªç­–ç•¥ (CompletableFuture + ThreadPool)
   â”‚      â”œâ”€â–¶ StrategyDispatcher.dispatch()
   â”‚      â”‚     â”œâ”€â–¶ StrategyRegistry.get()
   â”‚      â”‚     â”œâ”€â–¶ new CachingDecorator(strategy)
   â”‚      â”‚     â””â”€â–¶ QuantStrategy.execute()
   â”‚      â”‚            â”œâ”€â–¶ è·å–è¡Œæƒ… / DBæ•°æ®
   â”‚      â”‚            â””â”€â–¶ è¿”å› StrategyResult
   â”‚      â””â”€â–¶ æ±‡èšç»“æœä¸º StrategyResultBundle
   â”œâ”€â–¶ KafkaResultPublisher.publish()
   â””â”€â–¶ è¿”å› SSE/HTTP å“åº”ç»™ç”¨æˆ·
```



## ğŸ“ˆ å…­ã€æ€§èƒ½ä¸é«˜å¹¶å‘ä¼˜åŒ–ç‚¹

| ä¼˜åŒ–ç‚¹                            | æŠ€æœ¯æ–¹æ¡ˆ                            | æ•ˆæœ                     |
| --------------------------------- | ----------------------------------- | ------------------------ |
| **åˆ†å¸ƒå¼é” + Request Coalescing** | Redisson + PendingFuture Map        | é˜²æ­¢é‡å¤è®¡ç®—çƒ­ç‚¹ç»„åˆè¯·æ±‚ |
| **å¹¶å‘æ‰§è¡Œ**                      | `CompletableFuture + è‡ªå®šä¹‰çº¿ç¨‹æ± `  | åˆ©ç”¨CPUæ ¸æ•°å¹¶è¡Œè®¡ç®—ç­–ç•¥  |
| **å¤šçº§ç¼“å­˜**                      | Caffeine (L1) + Redis (L2)          | å‡å°‘å¤–éƒ¨ä¾èµ–è®¿é—®å»¶è¿Ÿ     |
| **å¼‚æ­¥è§£è€¦**                      | Kafka æ¨é€ç»“æœ                      | æé«˜ç³»ç»Ÿååä¸è§£è€¦æ€§     |
| **é™æµç†”æ–­**                      | Sentinel + RateLimiterService       | é˜²æ­¢è¿‡è½½ä¸é›ªå´©           |
| **ç›‘æ§è¿½è¸ª**                      | MetricsCollector + TraceInterceptor | å¯è§‚æµ‹æ€§ã€æŠ¥è­¦èƒ½åŠ›       |
| **åŠ¨æ€é…ç½®**                      | Nacos                               | è¿è¡Œæ—¶è°ƒæ•´çº¿ç¨‹æ± ä¸å‚æ•°   |

---



## ğŸ§  ä¸ƒã€æ‰§è¡Œç¤ºä¾‹ï¼ˆé€»è¾‘é¡ºåºï¼‰

```java
@PostMapping("/execute")
public SseEmitter execute(@RequestBody StrategyRequest req) {
    // 1. å…¥å£è¯·æ±‚
    // 2. æ„é€ ä¸Šä¸‹æ–‡ -> StrategyContext
    // 3. è°ƒç”¨ StrategyEngineFacade.executeAll(...)
    // 4. Facade å†…éƒ¨æ‰§è¡Œï¼š
    //     a. è´£ä»»é“¾ -> é£æ§ã€é™æµ
    //     b. åˆ†å¸ƒå¼é” -> é˜²æ­¢é‡å¤è®¡ç®—
    //     c. å¹¶å‘æ‰§è¡Œç­–ç•¥
    //     d. ç¼“å­˜ + ç»“æœèšåˆ
    //     e. Kafka å¼‚æ­¥å‘å¸ƒ
    // 5. SSE è¿”å›ç»“æœåˆ°å®¢æˆ·ç«¯
}
```



## ğŸ§© å…«ã€æ¨¡å—èŒè´£ä¸€è§ˆè¡¨

| æ¨¡å—            | èŒè´£                                    |
| --------------- | --------------------------------------- |
| **api**         | æš´éœ²æ¥å£ï¼Œæ¥æ”¶ç”¨æˆ·è¯·æ±‚                  |
| **core**        | è´Ÿè´£ç­–ç•¥æ‰§è¡Œã€é”åè°ƒã€ä»»åŠ¡è°ƒåº¦          |
| **strategy**    | ç­–ç•¥ç®—æ³•é›†åˆï¼Œå¯æ’æ‹”ã€å¯å¤ç”¨            |
| **chain**       | å‰ç½®éªŒè¯ä¸é£æ§è´£ä»»é“¾                    |
| **common**      | å…¬å…±æ¨¡å‹ã€å·¥å…·ã€é…ç½®                    |
| **integration** | å¤–éƒ¨ç³»ç»Ÿé›†æˆï¼ˆKafka/Redis/Feign/Nacosï¼‰ |
| **resilience**  | å®¹é”™ã€é™æµã€ç†”æ–­æœºåˆ¶                    |
| **monitoring**  | æ€§èƒ½ç›‘æ§ã€è¿½è¸ªä¸å‘Šè­¦                    |
| **service**     | å¯¹å¤–ä¸šåŠ¡å°è£…å±‚ï¼Œåè°ƒä¸åŒæ¨¡å—            |



## ğŸ§© ä¹ã€æ€»ç»“

è¯¥æ¨¡å—èåˆå¤šç§è®¾è®¡æ€æƒ³ä¸å®è·µï¼š

- ä½¿ç”¨ **ç­–ç•¥ + è£…é¥°è€… + è´£ä»»é“¾ + å¤åˆæ¨¡å¼** æå‡æ‰©å±•æ€§ï¼›
- ç»“åˆ **åˆ†å¸ƒå¼é” + Kafka + Redis** æ„å»ºå¯æ¨ªå‘æ‰©å±•çš„é«˜å¹¶å‘æ¶æ„ï¼›
- æ‹¥æœ‰å®Œå–„çš„ **ç›‘æ§ã€ç†”æ–­ã€é™æµä¸åŠ¨æ€é…ç½®æœºåˆ¶**ï¼›
- æ˜¯ä¸€ä¸ªå®Œæ•´çš„ã€**å·¥ç¨‹åŒ–çš„ç­–ç•¥å¼•æ“å¾®æœåŠ¡æ¨¡å—**ï¼Œå¯åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ç¨³å®šè¿è¡Œã€‚

> âœ… **ä¸€å¥è¯æ€»ç»“ï¼š**
>  `quant-strategy-engine` æ˜¯ä¸€ä¸ªå¯æ¨ªå‘æ‰©å±•ã€å¯è§‚æµ‹ã€å¯æ¼”è¿›çš„åˆ†å¸ƒå¼ç­–ç•¥æ‰§è¡Œå¼•æ“ï¼Œ
>  é€šè¿‡æ¨¡å—åŒ–ä¸è®¾è®¡æ¨¡å¼ç»„åˆï¼Œå®ç°é«˜å¯ç”¨ã€é«˜æ€§èƒ½ã€é«˜å¯ç»´æŠ¤æ€§ã€‚





## ğŸª„ Mermaid è°ƒç”¨æµç¨‹å›¾



```mermaid
flowchart TD
    %% ========== å›¾æ ‡é¢˜ ==========
    subgraph User["ğŸ‘¤ User Request"]
        A1["å‘èµ·ç­–ç•¥è¯·æ±‚ /api/strategy/execute"]
    end

    subgraph API["ğŸ§­ API å±‚ (Controller)"]
        B1["StrategyController.execute()"]
        B2["æ„é€  StrategyContext"]
        B3["è°ƒç”¨ StrategyEngineFacade.executeAll()"]
        A1 --> B1 --> B2 --> B3
    end

    subgraph FACADE["ğŸ—ï¸ Facade å±‚ (StrategyEngineFacade)"]
        C1["æ‰§è¡Œè´£ä»»é“¾ StrategyChain.apply()"]
        C2["ç”Ÿæˆ comboKey (KeyUtils)"]
        C3["åˆ†å¸ƒå¼é”æ£€æŸ¥ DistributedLockService.acquireOrWait()"]
        C4["å¹¶å‘æ‰§è¡Œç­–ç•¥ CompletableFuture + ThreadPool"]
        C5["èšåˆç»“æœ StrategyResultBundle"]
        C6["å¼‚æ­¥æ¨é€ KafkaResultPublisher.publish()"]
        B3 --> C1 --> C2 --> C3 --> C4 --> C5 --> C6
    end

    subgraph CHAIN["ğŸ§© è´£ä»»é“¾ (Chain of Responsibility)"]
        D1["AuthHandler é‰´æƒ"]
        D2["RateLimitHandler é™æµ"]
        D3["RiskCheckHandler é£æ§"]
        C1 --> D1 --> D2 --> D3
    end

    subgraph CORE["âš™ï¸ æ ¸å¿ƒè°ƒåº¦ (Dispatcher)"]
        E1["StrategyDispatcher.dispatch()"]
        E2["StrategyRegistry æŸ¥æ‰¾ç­–ç•¥å®ç°"]
        E3["è£…é¥°è€…åŒ…è£… CachingDecorator"]
        E4["æ‰§è¡Œ QuantStrategy.execute()"]
        C4 --> E1 --> E2 --> E3 --> E4
    end

    subgraph STRATEGY["ğŸ“ˆ ç­–ç•¥å®ç° (Strategy Layer)"]
        F1["MovingAverageStrategy ç§»åŠ¨å‡çº¿"]
        F2["MomentumStrategy åŠ¨é‡ç­–ç•¥"]
        F3["CompositeStrategy å¤åˆç­–ç•¥"]
        E4 --> F1 & F2 & F3
    end

    subgraph CACHE["ğŸ§  ç¼“å­˜å±‚ (Cache Layer)"]
        G1["L1CacheService (Caffeine)"]
        G2["StrategyCacheService (Redis)"]
        E3 --> G1 --> G2
    end

    subgraph LOCK["ğŸ”’ åˆ†å¸ƒå¼é” (Redis + PendingMap)"]
        H1["å°è¯•åŠ é” Redisson.tryLock()"]
        H2["ç­‰å¾… pendingFuture æˆ–æ‰§è¡Œ compute()"]
        C3 --> H1 --> H2
    end

    subgraph PUBSUB["ğŸ“¬ å¼‚æ­¥åˆ†å‘ (Kafka)"]
        I1["KafkaResultPublisher.publish()"]
        I2["KafkaConsumerService.consume()"]
        C6 --> I1 --> I2
    end

    subgraph MONITOR["ğŸ“Š ç›‘æ§æ¨¡å— (Monitoring)"]
        J1["TraceInterceptor è·Ÿè¸ªè°ƒç”¨é“¾"]
        J2["MetricsCollector æ”¶é›†æ€§èƒ½æŒ‡æ ‡"]
        J3["AlertService å‘Šè­¦å¼‚å¸¸/è¶…æ—¶"]
        B1 -.-> J1
        C1 -.-> J2
        C6 -.-> J3
    end

    subgraph RESILIENCE["ğŸ§± é™æµä¸å®¹é”™ (Resilience)"]
        K1["RateLimiterService"]
        K2["CircuitBreakerService"]
        K3["FallbackHandler"]
        D2 -.-> K1
        C4 -.-> K2
        E1 -.-> K3
    end

    %% ========== ç»ˆç‚¹ ==========
    subgraph RESULT["ğŸ§¾ ç»“æœè¿”å›"]
        Z1["è¿”å› SSE æµå¼ç»“æœ"]
        Z2["Kafka å¼‚æ­¥æŒä¹…åŒ– & ä¸‹æ¸¸æ¶ˆè´¹"]
        C6 --> Z1
        I2 --> Z2
    end

```



### ğŸ§  é˜…è¯»è¯´æ˜ï¼ˆå›¾è§£ç»“æ„å±‚æ¬¡ï¼‰

| å±‚çº§               | ä¸»è¦èŒè´£                               | å…³é”®ç±»                                                       |
| ------------------ | -------------------------------------- | ------------------------------------------------------------ |
| **Controller å±‚**  | æ¥æ”¶ HTTP è¯·æ±‚ï¼Œç»„è£…ä¸Šä¸‹æ–‡             | `StrategyController`                                         |
| **Facade å±‚**      | å°è£…ç­–ç•¥æ‰§è¡Œçš„å®Œæ•´æµç¨‹                 | `StrategyEngineFacade`                                       |
| **Chain å±‚**       | é‰´æƒã€é£æ§ã€é™æµç­‰å‰ç½®è´£ä»»é“¾           | `AuthHandler`, `RateLimitHandler`, `RiskCheckHandler`        |
| **Core å±‚**        | ç­–ç•¥åˆ†å‘ã€æ³¨å†Œä¸­å¿ƒã€å¼‚å¸¸æ•è·           | `StrategyDispatcher`, `StrategyRegistry`                     |
| **Strategy å±‚**    | å„ç§ç®—æ³•å®ç°                           | `MovingAverageStrategy`, `MomentumStrategy`, `CompositeStrategy` |
| **Cache å±‚**       | å¤šçº§ç¼“å­˜ï¼ˆL1+Caffeineï¼ŒL2+Redisï¼‰      | `StrategyCacheService`, `L1CacheService`                     |
| **Lock å±‚**        | Redis åˆ†å¸ƒå¼é” + Request Coalescing    | `DistributedLockService`                                     |
| **Integration å±‚** | å¤–éƒ¨ç³»ç»Ÿï¼ˆKafkaã€Redisã€Nacosã€Feignï¼‰ | å¯¹åº”å­åŒ…                                                     |
| **Resilience å±‚**  | é™æµã€ç†”æ–­ã€Fallback å¤„ç†              | `RateLimiterService`, `CircuitBreakerService`                |
| **Monitoring å±‚**  | å¯è§‚æµ‹æ€§ã€Tracingã€Metricsã€å‘Šè­¦       | `TraceInterceptor`, `MetricsCollector`, `AlertService`       |













































